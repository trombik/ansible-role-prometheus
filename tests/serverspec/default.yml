- hosts: localhost
  roles:
    - role: trombik.freebsd_pkg_repo
      when:
        - ansible_os_family == 'FreeBSD'
    - role: ansible-role-prometheus
  vars:
    freebsd_pkg_repo:
      FreeBSD_latest:
        enabled: "true"
        state: present
        # use a mirror in Asia
        url: pkg+http://pkg0.twn.freebsd.org/${ABI}/latest
        mirror_type: srv
        signature_type: fingerprints
        fingerprints: /usr/share/keys/pkg
        priority: 100
    os_prometheus_flags:
      FreeBSD: |
        prometheus_args="--query.max-concurrency=21"
      Debian: |
        ARGS="--query.max-concurrency=21"
      OpenBSD: ""
    prometheus_flags: "{{ os_prometheus_flags[ansible_os_family] }}"

    os_prometheus_extra_packages:
      Debian:
        - name: python-prometheus-client
      FreeBSD:
        - name: net-mgmt/py-prometheus-client
      OpenBSD:
        - name: zsh
    prometheus_extra_packages: "{{ os_prometheus_extra_packages[ansible_os_family] }}"

    prometheus_config:
      global:
        scrape_interval:
        evaluation_interval:
      alerting:
        alertmanagers:
          - static_configs:
            - targets:
      rule_files:
      scrape_configs:
        - job_name: 'prometheus'
          static_configs:
            - targets: ['localhost:9090']
